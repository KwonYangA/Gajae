<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace = "review" >
	<insert id="reviewInsert" parameterType="map">
		INSERT INTO REVIEW(
			REVIEW_NUMBER,
			R_NUMBER,
			REVIEW_TITLE,
			REVIEW_GOOD,
			REVIEW_BAD,
			REVIEW_DATE,
			REVIEW_PHOTO,
			REVIEW_SERVICE,
			REVIEW_FACILITY,
			REVIEW_CLEAN,
			REVIEW_LOCATION,
			REVIEW_COST,
			REVIEW_AVERAGE
		) VALUES (
					 SEQ_REVIEW_NUMBER.NEXTVAL,
					 #{R_NUMBER},
					 #{REVIEW_TITLE},
					 #{REVIEW_GOOD},
					 #{REVIEW_BAD},
					 TO_CHAR( SYSDATE, 'YYYY-MM-DD'),
					 #{REVIEW_PHOTO},
					 #{REVIEW_SERVICE},
					 #{REVIEW_FACILITY},
					 #{REVIEW_CLEAN},
					 #{REVIEW_LOCATION},
					 #{REVIEW_COST},
					 #{REVIEW_AVERAGE}
				 )
	</insert>

	<select id="propertyList" parameterType="java.util.HashMap" resultType="map">
		SELECT R.R_NUMBER,
			   R.USER_ID,
			   R.R_PEOPLE,
			   RV.REVIEW_AVERAGE,
			   TO_DATE(R.R_START_DATE, 'YYYY-MM-DD') AS CHECKIN_DATE,
			   TO_DATE(R.R_END_DATE, 'YYYY-MM-DD') AS CHECKOUT_DATE,
			   TO_DATE(R.R_END_DATE, 'YYYY-MM-DD') - TO_DATE(R.R_START_DATE, 'YYYY-MM-DD') AS NUM_NIGHTS,
			   RV.REVIEW_TITLE, RV.REVIEW_DATE, RV.REVIEW_GOOD, RV.REVIEW_BAD
		FROM RESERVATIONS R
				 JOIN REVIEW RV
					  ON R.R_NUMBER = RV.R_NUMBER
		WHERE R.P_ID = #{P_ID}
	</select>

	<!-- 나의 리뷰 리스트  -->
	<select id="myReviewList" parameterType="java.util.HashMap" resultType="map">
		SELECT R.REVIEW_NUMBER, R.REVIEW_TITLE, R.REVIEW_DATE, R.REVIEW_GOOD,
			   R.REVIEW_BAD, R.REVIEW_PHOTO, R.REVIEW_SERVICE, R.REVIEW_FACILITY,
			   R.REVIEW_CLEAN, R.REVIEW_COST, R.REVIEW_LOCATION, R.REVIEW_AVERAGE
		FROM REVIEW R JOIN RESERVATIONS RV ON R.REVIEW_NUMBER = RV.REVIEW_NUMBER
		WHERE RV.USER_ID = #{USER_ID}
		ORDER BY R.REVIEW_NUMBER DESC
	</select>

	<!--나의 리뷰 Detail -->
	<select id="myReviewDetail" parameterType="java.util.HashMap" resultType="map">
		SELECT REVIEW_NUMBER, REVIEW_TITLE, REVIEW_GOOD, REVIEW_BAD, REVIEW_DATE, REVIEW_PHOTO,
			   REVIEW_SERVICE, REVIEW_FACILITY, REVIEW_CLEAN, REVIEW_LOCATION, REVIEW_COST
		FROM REVIEW
		WHERE REVIEW_NUMBER = #{REVIEW_NUMBER}
	</select>

	<update id="reviewUpdate" parameterType="map">
		UPDATE REVIEW
		SET
			REVIEW_TITLE = #{REVIEW_TITLE},
			REVIEW_GOOD = #{REVIEW_GOOD},
			REVIEW_BAD = #{REVIEW_BAD},
			REVIEW_DATE = TO_CHAR( SYSDATE, 'YYYY-MM-DD'),
			REVIEW_SERVICE = #{REVIEW_SERVICE},
			REVIEW_FACILITY =#{REVIEW_FACILITY},
			REVIEW_CLEAN = #{REVIEW_CLEAN},
			REVIEW_LOCATION = #{REVIEW_LOCATION},
			REVIEW_COST = #{REVIEW_COST}
		WHERE REVIEW_NUMBER = #{REVIEW_NUMBER}
	</update>
	<delete id="reviewDelete" parameterType="map">
		DELETE FROM REVIEW
		WHERE REVIEW_NUMBER = #{REVIEW_NUMBER}
	</delete>
</mapper>