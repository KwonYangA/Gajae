<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.gajae.demo">
	<!-- 검색 -->
	<select id="searchlist" parameterType="map" resultType="map">
		SELECT P.P_ID, P.P_TITLE, P.P_ADDRESS, P.P_CHECKOUT,
		WM_CONCAT(DISTINCT B.P_EXTRA) AS P_EXTRA,
		P.P_CHECKIN, P.P_REFUND,
		MAX(A.ROOM_PRICE) AS ROOM_PRICE,
		WM_CONCAT(DISTINCT A.ROOM_TYPE) AS
		ROOM_TYPE, MAX(A.ROOM_OPTION) AS ROOM_OPTION
		FROM PROPERTIES P,
		P_ROOMTYPE A, P_EXTRAS B
		WHERE P.ROOM_ID = A.ROOM_ID
		<if test="P_ADDRESS != null">
			AND P_ADDRESS LIKE '%${P_ADDRESS}%'
		</if>
		<if test="ROOM_CAPACITY != null">
			AND A.ROOM_CAPACITY >= '${ROOM_CAPACITY}'
		</if>
		<if test="P_ADDRESS != null">
			AND P.P_ID = B.P_ID
		</if>
		<if test="P_EXTRA != null">
			AND B.P_EXTRA LIKE '%${P_EXTRA}%'
		</if>
		<if test="P_STAR">
			AND P.P_STAR = '${P_STAR}'
		</if>
		GROUP BY P.P_ID, P.P_TITLE, P.P_ADDRESS, P.P_CHECKOUT, P.P_CHECKIN,
		P.P_REFUND
	</select>
	<!-- 정렬조건 -->
	<select id="priceLow" parameterType="map" resultType="map">
		SELECT *
		FROM (
		SELECT P.P_ID, P.P_TITLE, P.P_ADDRESS, P.P_CHECKOUT,
		P.P_CHECKIN,
		P.P_REFUND, MIN(A.ROOM_PRICE) AS ROOM_PRICE,
		MAX(A.ROOM_TYPE) AS
		ROOM_TYPE, MAX(A.ROOM_OPTION) AS ROOM_OPTION
		FROM
		PROPERTIES P, P_ROOMTYPE A
		WHERE P.ROOM_ID = A.ROOM_ID
		<if test="P_ADDRESS != null">
			AND P_ADDRESS LIKE '%${P_ADDRESS}%'
		</if>
		GROUP BY P.P_ID, P.P_TITLE, P.P_ADDRESS, P.P_CHECKOUT, P.P_CHECKIN,
		P.P_REFUND
		) T
		ORDER BY T.ROOM_PRICE ASC
	</select>
	<select id="priceHigh" parameterType="map" resultType="map">
		SELECT *
		FROM (
		SELECT P.P_ID, P.P_TITLE, P.P_ADDRESS, P.P_CHECKOUT,
		P.P_CHECKIN,
		P.P_REFUND, MIN(A.ROOM_PRICE) AS ROOM_PRICE,
		MAX(A.ROOM_TYPE) AS
		ROOM_TYPE, MAX(A.ROOM_OPTION) AS ROOM_OPTION
		FROM
		PROPERTIES P, P_ROOMTYPE A
		WHERE P.ROOM_ID = A.ROOM_ID
		<if test="P_ADDRESS != null">
			AND P_ADDRESS LIKE '%${P_ADDRESS}%'
		</if>
		GROUP BY P.P_ID, P.P_TITLE, P.P_ADDRESS, P.P_CHECKOUT, P.P_CHECKIN,
		P.P_REFUND
		) T
		ORDER BY T.ROOM_PRICE DESC
	</select>
	<select id="markList" parameterType="map" resultType="map">
		SELECT DISTINCT P_MAPX, P_MAPY, P_ID, P_TITLE, P_STAR
		FROM PROPERTIES
		WHERE P_ID IN (1, 2, 3, 4, 5, 6, 7, 8, 9, 10)
	</select>
</mapper>