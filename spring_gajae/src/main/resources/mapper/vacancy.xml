<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="vacancy">

	<select id="getCheckedDate" parameterType="map" resultType="map">
		SELECT
		R_START_DATE,
		R_END_DATE
		FROM GAJAE.RESERVATIONS
		WHERE
		R_NUMBER =
		#{R_NUMBER}
	</select>

	<!-- 달력create -->
	<insert id="vacancyCreate" parameterType="int">
		CREATE TABLE
		GAJAE.P_VACANCY_${p_id}
		(
		P_ID NUMBER(5) NOT NULL,
		ROOM_ID NUMBER(10) NOT
		NULL,
		RES_DATE VARCHAR2(50 BYTE),
		RES_YN VARCHAR2(2 BYTE) DEFAULT 'N'
		NOT NULL
		)
	</insert>


	<!-- 달력insert -->
	<insert id="vacancyInsert" parameterType="list">
    <foreach item="vacancy" index="index" collection="list" separator=";">
        INSERT INTO P_VACANCY_#{vacancy.p_id} (P_ID, ROOM_ID, RES_DATE, RES_YN)
        SELECT #{vacancy.p_id}, #{vacancy.ROOM_ID}, TO_CHAR(LEVEL - 1 + TO_DATE('2023-04-24', 'YYYY-MM-DD'), 'YYYY-MM-DD'), 'N'
        FROM DUAL
        WHERE LEVEL  <![CDATA[ <= ]]> (TO_DATE('2023-07-30', 'YYYY-MM-DD') - TO_DATE('2023-04-24', 'YYYY-MM-DD') + 1)
        CONNECT BY LEVEL  <![CDATA[ <= ]]> (TO_DATE('2023-07-30', 'YYYY-MM-DD') - TO_DATE('2023-04-24', 'YYYY-MM-DD') + 1);
    </foreach>
</insert>


	<!-- <insert id="vacancyInsert" parameterType="map"> INSERT INTO P_VACANCY_${p_id} 
		(P_ID, ROOM_ID, RES_DATE, RES_YN) SELECT #{p_id}, ROOM_ID, TO_CHAR(LEVEL 
		- 1 + DATE '2023-04-24', 'YYYY-MM-DD'), 'N' FROM ( <foreach item="item" index="index" 
		collection="roomIds" separator="UNION ALL"> SELECT #{item} AS ROOM_ID FROM 
		DUAL </foreach> ) ROOMS CONNECT BY LEVEL <![CDATA[ <= ]]> (DATE '2023-07-30' 
		- DATE '2023-04-24' + 1) </insert> -->
	<insert id="vacancyInsert2" parameterType="map">
		INSERT INTO P_VACANCY_${p_id}(
		P_ID,
		ROOM_ID,
		RES_DATE,
		RES_YN)
		SELECT
		#{p_id},
		ROOM_ID,
		TO_CHAR(LEVEL - 1 + DATE '2023-04-24', 'YYYY-MM-DD'),
		'N'
		FROM (
		<foreach item="item" index="index" collection="roomIds"
			separator="UNION ALL">
			SELECT #{item} AS ROOM_ID FROM DUAL
		</foreach>
		) ROOMS
		CONNECT BY LEVEL <![CDATA[ <= ]]>
		(DATE '2023-07-30' - DATE '2023-04-24' + 1)
	</insert>
</mapper>